@model PulpMXFantasy.Web.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<h1 class="page-title">Dashboard</h1>

@if (Model.NextEvent != null)
{
    <div class="card event-card mb-4">
        <div class="card-body">
            <p class="section-title">Next Event</p>
            <h2 class="event-name">@Model.NextEvent.Name</h2>

            <div class="event-meta">
                <div class="event-meta-item">
                    <span class="event-meta-label">Date</span>
                    <span class="event-meta-value">@Model.NextEvent.EventDate.ToString("MMMM dd, yyyy")</span>
                </div>
                <div class="event-meta-item">
                    <span class="event-meta-label">Series</span>
                    <span class="event-meta-value">@Model.NextEvent.SeriesName</span>
                </div>
                <div class="event-meta-item">
                    <span class="event-meta-label">Season</span>
                    <span class="event-meta-value">@Model.NextEvent.SeasonYear</span>
                </div>
                @if (Model.NextEvent.LockoutTime.HasValue)
                {
                    var isLocked = Model.NextEvent.LockoutTime.Value <= DateTimeOffset.UtcNow;
                    <div class="event-meta-item">
                        <span class="event-meta-label">Picks Lock</span>
                        <span class="event-meta-value">
                            @if (isLocked)
                            {
                                <span class="status-badge status-locked">Locked</span>
                            }
                            else
                            {
                                <span class="local-time" data-utc="@Model.NextEvent.LockoutTime.Value.UtcDateTime.ToString("o")"></span>
                            }
                        </span>
                    </div>
                }
            </div>

            <a asp-controller="Predictions" asp-action="Index" class="btn btn-primary">
                View Predictions
            </a>
        </div>
    </div>
}
else
{
    <div class="card mb-4">
        <div class="card-body empty-state">
            <svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <h3 class="empty-state-title">No Upcoming Events</h3>
            <p class="empty-state-text">Sync data from the PulpMX API in the Admin panel to get started.</p>
            <a asp-controller="Admin" asp-action="Index" class="btn btn-secondary mt-3">Go to Admin</a>
        </div>
    </div>
}

<div class="grid-2 mb-4">
    <div class="card card-lift">
        <div class="card-body stat-card">
            <div class="stat-value">@Model.TotalRiders</div>
            <div class="stat-label">Riders</div>
        </div>
    </div>
    <div class="card card-lift">
        <div class="card-body stat-card">
            <div class="stat-value">@Model.TotalEvents</div>
            <div class="stat-label">Events</div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5>Quick Actions</h5>
    </div>
    <div class="card-body">
        <div class="quick-actions">
            <a asp-controller="Predictions" asp-action="Index" class="btn btn-primary">
                View Predictions
            </a>
            <a asp-controller="Admin" asp-action="Index" class="btn btn-secondary">
                Admin Panel
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.local-time').forEach(function(el) {
                const utc = el.dataset.utc;
                if (!utc) return;

                const date = new Date(utc);
                el.textContent = date.toLocaleString([], { dateStyle: 'short', timeStyle: 'short' });
            });
        });
    </script>
}
